<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Benchmark Explorer â€” SustainAlign</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            sblue: '#D7EEF7',
            sblue600: '#3B97C1',
            sgreen: '#E8F8EE',
            sgreen600: '#4FB48E',
            accent: '#6EC5C5'
          }
        }
      }
    }
  </script>

  <style>
    :root { --glass: rgba(255,255,255,0.45); }
    .glass { background: var(--glass); backdrop-filter: blur(8px); }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-sblue to-sgreen text-slate-800">

<!-- NAV SLOT -->
<div id="nav-slot"></div>

<main class="max-w-6xl mx-auto p-6 space-y-10">

  <!-- SECTOR SELECTION -->
  <section class="glass p-6 rounded-xl shadow">
    <h2 class="text-xl font-bold">Sector Benchmarking</h2>
    <p class="text-sm text-slate-700 mt-1">Bandingkan performa perusahaan terhadap standar sektor industri.</p>

    <div class="mt-4 flex gap-4 items-end">
      <div class="flex-1">
        <label class="text-sm font-medium">Pilih Sektor</label>
        <select id="sectorSelect" class="mt-1 w-full p-2 rounded-lg bg-white/70 border">
          <option value="manufacturing">Manufacturing</option>
          <option value="energy">Energy</option>
          <option value="finance">Finance</option>
          <option value="agri">Agriculture</option>
        </select>
      </div>
      <button id="runBenchmark" class="px-4 py-2 bg-sblue600 text-white rounded-lg">Run Benchmark</button>
    </div>
  </section>

  <!-- SCORES -->
  <section class="grid md:grid-cols-2 gap-6">

    <div class="glass p-6 rounded-xl shadow">
      <h3 class="text-lg font-bold">Benchmark Scores</h3>

      <div class="mt-4 space-y-2">
        <div class="flex justify-between text-sm"><span>Company Score</span><span id="companyScore" class="font-bold">--</span></div>
        <div class="flex justify-between text-sm"><span>Industry Average</span><span id="industryScore" class="font-bold">--</span></div>
        <div class="flex justify-between text-sm"><span>Gap</span><span id="gapScore" class="font-bold">--</span></div>
      </div>
    </div>

    <!-- RADAR -->
    <div class="glass p-6 rounded-xl shadow">
      <h3 class="text-lg font-bold">ESG Radar</h3>
      <canvas id="radarChart" class="mt-4"></canvas>
    </div>

  </section>

  <!-- INSIGHTS -->
  <section class="glass p-6 rounded-xl shadow">
    <h3 class="text-lg font-bold">AI-Like Insights</h3>
    <div id="insightBox" class="mt-3 p-4 bg-white/70 rounded-lg text-sm text-slate-700">Jalankan benchmark untuk melihat insight.</div>
  </section>

  <!-- EXPORT -->
  <section class="glass p-6 rounded-xl shadow">
    <h3 class="text-lg font-bold">Export Benchmark Summary</h3>
    <div class="mt-4 flex gap-3">
      <button id="downloadJSON" class="px-4 py-2 bg-sgreen600 text-white rounded-lg">Download JSON</button>
      <button id="downloadHTML" class="px-4 py-2 bg-accent text-white rounded-lg">Export HTML</button>
    </div>
  </section>

</main>

<!-- FOOTER SLOT -->
<div id="footer-slot"></div>

<script type="module">
  import { injectLayout } from "../shared/components.js";
  import { getSectorBenchmark, getRadarData, generateInsight, exportBenchmarkJSON, exportBenchmarkHTML } from "./benchmark.js";

  injectLayout();

  const el = (id) => document.getElementById(id);
  let radarInstance = null;

  el("runBenchmark").addEventListener("click", () => {
    const sector = el("sectorSelect").value;
    const data = getSectorBenchmark(sector);

    el("companyScore").textContent = data.company + "%";
    el("industryScore").textContent = data.industry + "%";
    el("gapScore").textContent = data.gap + "%";

    const radarData = getRadarData(sector);
    const ctx = document.getElementById("radarChart");

    if (radarInstance) radarInstance.destroy();

    radarInstance = new Chart(ctx, {
      type: "radar",
      data: radarData,
      options: { scales: { r: { beginAtZero: true, max: 100 } } }
    });

    el("insightBox").innerHTML = generateInsight(data);

    localStorage.setItem("selectedSector", sector);
  });

  el("downloadJSON").addEventListener("click", () => {
    exportBenchmarkJSON(el("sectorSelect").value);
  });

  el("downloadHTML").addEventListener("click", () => exportBenchmarkHTML());

  document.addEventListener("DOMContentLoaded", () => {
    const last = localStorage.getItem("selectedSector");
    if (last) el("sectorSelect").value = last;
  });

</script>

</body>
</html>
